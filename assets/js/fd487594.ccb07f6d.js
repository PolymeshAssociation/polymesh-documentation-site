"use strict";(self.webpackChunkpolymesh_developer_documentation=self.webpackChunkpolymesh_developer_documentation||[]).push([[21826],{8222:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var i=t(74848),a=t(28453);const o={sidebar_position:6,title:"CDD with the SDK",description:"Provide customer due diligence with the Polymesh SDK",slug:"/kyc/cdd-sdk/"},s=void 0,c={id:"kyc/cdd-sdk",title:"CDD with the SDK",description:"Provide customer due diligence with the Polymesh SDK",source:"@site/docs/07-kyc/cdd-sdk.mdx",sourceDirName:"07-kyc",slug:"/kyc/cdd-sdk/",permalink:"/polymesh-documentation-site/docs/kyc/cdd-sdk/",draft:!1,unlisted:!1,editUrl:"https://github.com/PolymeshAssociation/polymesh-documentation-site/edit/develop/docs/07-kyc/cdd-sdk.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,title:"CDD with the SDK",description:"Provide customer due diligence with the Polymesh SDK",slug:"/kyc/cdd-sdk/"},sidebar:"defaultSidebar",previous:{title:"KYC with the SDK",permalink:"/polymesh-documentation-site/docs/kyc/kyc-sdk/"},next:{title:"Useful Links",permalink:"/polymesh-documentation-site/docs/resources/github-repositories/"}},r={},d=[{value:"How to create a new account",id:"how-to-create-a-new-account",level:2},{value:"Information collection",id:"information-collection",level:3},{value:"Create the account",id:"create-the-account",level:3},{value:"The CDD attestation",id:"the-cdd-attestation",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Links",id:"links",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{TabItem:t,Tabs:o}=n;return t||u("TabItem",!0),o||u("Tabs",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["You ought to look at the previous chapter on ",(0,i.jsx)(n.em,{children:"KYC with the SDK"})," first."]})}),"\n",(0,i.jsx)(n.p,{children:"A CDD service provider is a privileged KYC service provider with a permissioned role to create DID's and add CDD claims to DID's."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["See the ",(0,i.jsx)(n.a,{href:"/docs/introduction/identity/",children:"introduction on identity"})," for a refresher."]})}),"\n",(0,i.jsx)(n.p,{children:"In particular:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.strong,{children:"brand new users"})," of Polymesh, the CDD provider needs to:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a new account controlled by the primary key asked by the user, and return the ",(0,i.jsx)(n.strong,{children:"DID"})," to the user;"]}),"\n",(0,i.jsx)(n.li,{children:"Add a CDD claim to that DID to verify they have gone through verification with them;"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.strong,{children:"existing users"})," that need a new CDD attestation, the CDD provider needs to re-verify the individual or entity and attach a new CDD claim to their existing DID;"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/docs/distribute/with-sdk/",children:"distribute with the SDK"})," for a reminder of the process."]})}),"\n",(0,i.jsx)(n.p,{children:"We assume the CDD service provider is named EzCdd and has a way to instantiate a Polymesh client."}),"\n",(0,i.jsxs)(o,{groupId:"code-language",children:[(0,i.jsx)(t,{value:"ts",label:"TypeScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const signingManagerEzCdd: LocalSigningManager =\n  await LocalSigningManager.create({\n    accounts: [\n      {\n        mnemonic: 'word51 word52 ...',\n      },\n    ],\n  });\n\nconst apiEzCdd: Polymesh = await Polymesh.connect({\n  nodeUrl: 'wss://testnet-rpc.polymesh.live', // or your preferred node\n  signingManager: signingManagerEzCdd,\n});\n"})})}),(0,i.jsx)(t,{value:"js",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const signingManagerEzCdd = await LocalSigningManager.create({\n  accounts: [\n    {\n      mnemonic: 'word51 word52 ...',\n    },\n  ],\n});\n\nconst apiEzCdd = await Polymesh.connect({\n  nodeUrl: 'wss://testnet-rpc.polymesh.live', // or your preferred node\n  signingManager: signingManagerEzCdd,\n});\n"})})})]}),"\n",(0,i.jsx)(n.h2,{id:"how-to-create-a-new-account",children:"How to create a new account"}),"\n",(0,i.jsx)(n.p,{children:"This part only applies if the user, say Bob, is brand new to Polymesh, or if Bob wants to create another account for himself."}),"\n",(0,i.jsx)(n.p,{children:"In that case, the CDD provider needs to create an account. This is a privileged operation, too, one that only a CDD service provider can accomplish. The CDD provider needs to ask Bob for the public key, or address, he wishes to associate with the account."}),"\n",(0,i.jsx)(n.h3,{id:"information-collection",children:"Information collection"}),"\n",(0,i.jsx)(n.p,{children:"Bob creates a private key and returns the computed address. For instance:"}),"\n",(0,i.jsxs)(o,{groupId:"code-language",children:[(0,i.jsx)(t,{value:"ts",label:"TypeScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const bobAddress: string = '5ED27JHWh9dPVnhvRfazMRNqrfMgcAUdvgD7hs3969PBuxqe'; // For instance\n"})})}),(0,i.jsx)(t,{value:"js",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const bobAddress = '5ED27JHWh9dPVnhvRfazMRNqrfMgcAUdvgD7hs3969PBuxqe'; // For instance\n"})})})]}),"\n",(0,i.jsx)(n.p,{children:"The provider needs to confirm that this key is not yet assigned to any other account."}),"\n",(0,i.jsxs)(o,{groupId:"code-language",children:[(0,i.jsx)(t,{value:"ts",label:"TypeScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const bobKeyInfo: Account = apiEzCdd.accountManagement.getAccount({\n  address: bobAddress,\n});\nconst bob: Identity = await bobKeyInfo.getIdentity();\nassert(bob === null);\n"})})}),(0,i.jsx)(t,{value:"js",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const bobKeyInfo = apiEzCdd.accountManagement.getAccount({\n  address: bobAddress,\n});\nconst bob = await bobKeyInfo.getIdentity();\nassert(bob === null);\n"})})})]}),"\n",(0,i.jsx)(n.h3,{id:"create-the-account",children:"Create the account"}),"\n",(0,i.jsxs)(n.p,{children:["With the certainty that ",(0,i.jsx)(n.strong,{children:"the key is not associated with any existing account"}),", it is time to create a new account with this key:"]}),"\n",(0,i.jsxs)(o,{groupId:"code-language",children:[(0,i.jsx)(t,{value:"ts",label:"TypeScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const newAccountQueue: TransactionQueue<Identity> =\n  await apiEzCdd.identities.registerIdentity({\n    targetAccount: bobAddress,\n  });\nconst bob: Identity = await newAccountQueue.run();\n"})})}),(0,i.jsx)(t,{value:"js",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const newAccountQueue = await apiEzCdd.identities.registerIdentity({\n  targetAccount: bobAddress,\n});\nconst bob = await newAccountQueue.run();\n"})})})]}),"\n",(0,i.jsx)(n.p,{children:"So does Bob have a new account on-chain? Not yet, sadly. Or rather, fortunately. You see, it is worth repeating that all actions of consequence need approval on both ends, and this is no different here. Bob needs to use his private key to approve having it associated with this new account."}),"\n",(0,i.jsxs)(n.p,{children:["So, either Bob goes to his Portal, and looks for incoming authorisation requests, or Bob fires up his own ",(0,i.jsx)(n.code,{children:"apiBob"})," and uses the SDK. We assume that EzCdd gave him their ",(0,i.jsx)(n.code,{children:"const ezCddDid: string"}),"."]}),"\n",(0,i.jsxs)(o,{groupId:"code-language",children:[(0,i.jsx)(t,{value:"ts",label:"TypeScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const bobAccount: Account = apiBob.accountManagement.getSigningAccount();\nconst pendingAuthorizations: AuthorizationRequest[] =\n  await bobAccount.authorizations.getReceived();\nconst ezCddAuthorization: AuthorizationRequest = pendingAuthorizations.find(\n  (pendingAuthorization: AuthorizationRequest) => {\n    return pendingAuthorization.issuer.did === ezCddDid;\n  }\n);\nconst acceptQueue: TransactionQueue<void> = await ezCddAuthorization.accept();\nawait acceptQueue.run();\n"})})}),(0,i.jsx)(t,{value:"js",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const bobAccount = apiBob.accountManagement.getSigningAccount();\nconst pendingAuthorizations = await bobAccount.authorizations.getReceived();\nconst ezCddAuthorization = pendingAuthorizations.find(\n  (pendingAuthorization) => {\n    return pendingAuthorization.issuer.did === ezCddDid;\n  }\n);\nconst acceptQueue = await ezCddAuthorization.accept();\nawait acceptQueue.run();\n"})})})]}),"\n",(0,i.jsxs)(n.p,{children:["There is only a ",(0,i.jsx)(n.em,{children:"slight problem"})," with the above. Bob has not yet received his CDD attestation, and therefore cannot publish a transaction to the Polymesh network. So we showed the above to ",(0,i.jsx)(n.em,{children:"stay in context"}),", but really, Bob has to wait for the below CDD attestation to be published before he can approve, or reject, the account association."]}),"\n",(0,i.jsx)(n.p,{children:"Additionally, the address needs some POLYX to pay for transaction fees. Bob can purchase them from an exchange, or he can have an agreement with EzCdd to send some to his address. Once again, only after the CDD attestation has been published."}),"\n",(0,i.jsx)(n.h2,{id:"the-cdd-attestation",children:"The CDD attestation"}),"\n",(0,i.jsxs)(n.p,{children:["Before an account can transact on chain it requires a valid CDD claim to be added to the DID. The CDD provider constructs a transaction to add a claim type of ",(0,i.jsx)(n.code,{children:"CustomerDueDiligence"})," providing Bob's DID as the target and an expiry date for the claim. The claim can include an optional ",(0,i.jsx)(n.code,{children:"cddId"})," should the CDD provider wish to use it as a reference."]}),"\n",(0,i.jsxs)(o,{groupId:"code-language",children:[(0,i.jsx)(t,{value:"ts",label:"TypeScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const nextYear: Date = new Date();\nnextYear.setFullYear(nextYear.getFullYear() + 1);\nconst cddClaimQueue: TransactionQueue<void> = await apiEzCdd.claims.addClaims({\n  claims: [\n    {\n      claim: {\n        type: ClaimType.CustomerDueDiligence,\n        id: cddId,\n      },\n      target: bob.did,\n      expiry: nextYear,\n    },\n  ],\n});\nawait cddClaimQueue.run();\n"})})}),(0,i.jsx)(t,{value:"js",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const nextYear = new Date();\nnextYear.setFullYear(nextYear.getFullYear() + 1);\nconst cddClaimQueue = await apiEzCdd.claims.addClaims({\n  claims: [\n    {\n      claim: {\n        type: ClaimType.CustomerDueDiligence,\n        id: cddId,\n      },\n      target: bob.did,\n      expiry: nextYear,\n    },\n  ],\n});\nawait cddClaimQueue.run();\n"})})})]}),"\n",(0,i.jsxs)(n.p,{children:["With this transaction submitted Bob is now ",(0,i.jsx)(n.em,{children:"CDD'd"})," and can transact in materially-significant ways, including, as mentioned earlier by accepting the authorisation request."]}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"We have seen how a CDD service provider needs to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"create new accounts on Polymesh, and"}),"\n",(0,i.jsx)(n.li,{children:"publish CDD attestations."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"links",children:"Links"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/sdk-docs/",children:"SDK documents"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var i=t(96540);const a={},o=i.createContext(a);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);
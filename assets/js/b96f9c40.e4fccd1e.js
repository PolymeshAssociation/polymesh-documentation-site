"use strict";(self.webpackChunkpolymesh_developer_documentation=self.webpackChunkpolymesh_developer_documentation||[]).push([[95956],{19429:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"core-concepts/corporate-actions/checkpoint-management","title":"Checkpoint Management","description":"Checkpoint Management","source":"@site/docs/200-core-concepts/070-corporate-actions/010-checkpoints.md","sourceDirName":"200-core-concepts/070-corporate-actions","slug":"/corporate-actions/checkpoints","permalink":"/polymesh-documentation-site/corporate-actions/checkpoints","draft":false,"unlisted":false,"editUrl":"https://github.com/PolymeshAssociation/polymesh-documentation-site/edit/develop/docs/200-core-concepts/070-corporate-actions/010-checkpoints.md","tags":[{"inline":true,"label":"corporate actions","permalink":"/polymesh-documentation-site/tags/corporate-actions"},{"inline":true,"label":"checkpoints","permalink":"/polymesh-documentation-site/tags/checkpoints"}],"version":"current","sidebarPosition":10,"frontMatter":{"title":"Checkpoint Management","description":"Checkpoint Management","id":"checkpoint-management","slug":"/corporate-actions/checkpoints","sidebar_label":"Checkpoint Management","tags":["corporate actions","checkpoints"]},"sidebar":"docs","previous":{"title":"Corporate Actions","permalink":"/polymesh-documentation-site/corporate-actions"},"next":{"title":"Dividend Distribution","permalink":"/polymesh-documentation-site/corporate-actions/dividends"}}');var s=n(74848),c=n(28453);const o={title:"Checkpoint Management",description:"Checkpoint Management",id:"checkpoint-management",slug:"/corporate-actions/checkpoints",sidebar_label:"Checkpoint Management",tags:["corporate actions","checkpoints"]},a="Overview",r={},h=[];function d(e){const t={code:"code",em:"em",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"overview",children:"Overview"})}),"\n",(0,s.jsxs)(t.p,{children:["An ",(0,s.jsx)(t.em,{children:"asset checkpoint"})," is a record of the balances of an asset at a specific time. These records capture both the total asset balance and the balances held by each identity."]}),"\n",(0,s.jsx)(t.p,{children:"Checkpoints are particularly useful for capital distributions and corporate ballots, where a consistent set of balances at a given time (or block) is needed, and can be used to determine how corporate actions are distributed, including how applicable taxes are withheld."}),"\n",(0,s.jsx)(t.h1,{id:"checkpoint-periods",children:"Checkpoint periods"}),"\n",(0,s.jsx)(t.p,{children:"There are two kinds of periods: ones of fixed length if measured in seconds -- multiples of seconds, minutes, hours, days or weeks -- and ones of variable length -- multiples of months or years."}),"\n",(0,s.jsx)(t.p,{children:"When computing the time when the next checkpoint is due, if the period is fixed the runtime adds the length of that period in seconds to the time when the last checkpoint was due."}),"\n",(0,s.jsx)(t.p,{children:"If the period is variable, the next timestamp computation takes into account the day of the month at the start of the schedule. Every checkpoint gets a day of the month that is at most that of the start of the schedule."}),"\n",(0,s.jsx)(t.p,{children:"For example, assume we have the checkpoint schedule that"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"starts on 00:01:00 the 31st of January, 2021 UTC and"}),"\n",(0,s.jsx)(t.li,{children:"has a period of one month."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The checkpoint timestamps are going to be"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"2021-01-31 00:01:00"}),"\n",(0,s.jsx)(t.li,{children:"2021-02-28 00:01:00"}),"\n",(0,s.jsx)(t.li,{children:"2021-03-31 00:01:00"}),"\n",(0,s.jsx)(t.li,{children:"2020-04-30 00:01:00"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"and so on."}),"\n",(0,s.jsx)(t.h1,{id:"creating-a-checkpoint",children:"Creating a Checkpoint"}),"\n",(0,s.jsx)(t.p,{children:"There are two ways to create a checkpoint:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Manual Checkpoint Creation"}),": Call the ",(0,s.jsx)(t.code,{children:"create_checkpoint(assetId)"})," function in the ",(0,s.jsx)(t.code,{children:"checkpoint"})," pallet. This creates an immediate checkpoint for the asset specified by ",(0,s.jsx)(t.code,{children:"AssetId"}),". The total balance is recorded instantly, while individual balances are recorded lazily (i.e., just before the next transaction involving each identity). If no transactions occur, no records are made for those identities."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Scheduled Checkpoints"}),": Set up a checkpoint schedule with ",(0,s.jsx)(t.code,{children:"create_schedule(assetId, schedule)"}),", specifying a series of ",(0,s.jsx)(t.code,{children:"Moment"})," timestamp values. Scheduled checkpoints are created automatically at the specified times but are otherwise identical to manual checkpoints. Scheduling of the next checkpoint also happens lazily only when an asset transaction or minting occurs. If no transactions happen when a checkpoint is due, it is not rescheduled, and the scheduler accounts for any missed checkpoints.\nScheduled checkpoints can be removed by calling the ",(0,s.jsx)(t.code,{children:"removeschedule(assetId, id)"})," function, specifying the ",(0,s.jsx)(t.code,{children:"AssetId"})," and the ",(0,s.jsx)(t.code,{children:"Id"})," of the checkpoint when it was created by ",(0,s.jsx)(t.code,{children:"create_schedule(assetId, schedule)"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h1,{id:"accessing-an-existing-checkpoint",children:"Accessing an existing Checkpoint"}),"\n",(0,s.jsx)(t.p,{children:"The checkpoints of an asset form a sequence that is indexed starting from 1. The total balance and balances of identities are stored at these indices."}),"\n",(0,s.jsxs)(t.p,{children:["To read the total supply of an ",(0,s.jsx)(t.code,{children:"AssetId"})," at checkpoint index ",(0,s.jsx)(t.code,{children:"i"})," one calls the getter ",(0,s.jsx)(t.code,{children:"total_supply_at(AssetId, i)"})," in the asset pallet. The getter returns the value directly from runtime storage."]}),"\n",(0,s.jsxs)(t.p,{children:["To read the checkpoint balance of identity one calls the function ",(0,s.jsx)(t.code,{children:"get_balance_at(AssetId, identity, i)"})," in the same pallet. This function returns the checkpoint balance at i by searching for the least checkpoint index greater or equal to i or, if no such record exists due to the absence of transactions, the current asset balance of identity."]}),"\n",(0,s.jsx)(t.p,{children:"The time at which a checkpoint was made is stored in a map indexed by checkpoint sequence numbers and can be read knowing the required sequence number."})]})}function l(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(96540);const s={},c=i.createContext(s);function o(e){const t=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(c.Provider,{value:t},e.children)}}}]);
"use strict";(globalThis.webpackChunkpolymesh_developer_documentation=globalThis.webpackChunkpolymesh_developer_documentation||[]).push([[70465],{1135(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"core-concepts/confidential-assets/confidential-assets-anonymous-fees","title":"Anonymous Fee Management","description":"Ensuring unlinkability through the Relayer Flow and Pooled System Account","source":"@site/docs/200-core-concepts/090-confidential-assets/060-anonymous-fees.mdx","sourceDirName":"200-core-concepts/090-confidential-assets","slug":"/confidential-assets/anonymous-fees","permalink":"/polymesh-documentation-site/confidential-assets/anonymous-fees","draft":false,"unlisted":false,"editUrl":"https://github.com/PolymeshAssociation/polymesh-documentation-site/edit/develop/docs/200-core-concepts/090-confidential-assets/060-anonymous-fees.mdx","tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"title":"Anonymous Fee Management","description":"Ensuring unlinkability through the Relayer Flow and Pooled System Account","sidebar_label":"Anonymous Fees","slug":"/confidential-assets/anonymous-fees","id":"confidential-assets-anonymous-fees"},"sidebar":"docs","previous":{"title":"Compliance & Regulation","permalink":"/polymesh-documentation-site/confidential-assets/compliance-and-regulation"},"next":{"title":"Comparisons","permalink":"/polymesh-documentation-site/confidential-assets/comparisons"}}');var t=i(74848),o=i(28453);const r={title:"Anonymous Fee Management",description:"Ensuring unlinkability through the Relayer Flow and Pooled System Account",sidebar_label:"Anonymous Fees",slug:"/confidential-assets/anonymous-fees",id:"confidential-assets-anonymous-fees"},l="Anonymous Fee Management: Ensuring Unlinkability through the Relayer Flow",a={},c=[{value:"Overview",id:"overview",level:2},{value:"The Pooled Fee System",id:"the-pooled-fee-system",level:2},{value:"Fee Account Registration",id:"fee-account-registration",level:2},{value:"Top-up (Funding the Pool)",id:"top-up-funding-the-pool",level:2},{value:"Anonymous Fee Proof Generation",id:"anonymous-fee-proof-generation",level:2},{value:"Public fee values vs. confidential proof",id:"public-fee-values-vs-confidential-proof",level:3},{value:"Anonymous Submission &amp; Relayer Broadcast",id:"anonymous-submission--relayer-broadcast",level:2},{value:"Automatic Reimbursement from Pool",id:"automatic-reimbursement-from-pool",level:2},{value:"Key Differences from Off-Chain Relayer Services",id:"key-differences-from-off-chain-relayer-services",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"anonymous-fee-management-ensuring-unlinkability-through-the-relayer-flow",children:"Anonymous Fee Management: Ensuring Unlinkability through the Relayer Flow"})}),"\n",(0,t.jsxs)(n.p,{children:["To protect user privacy while ensuring network transaction costs are paid, Polymesh Confidential Assets (PCA) employ a sophisticated transaction ",(0,t.jsx)(n.strong,{children:"Relayer Flow"})," centered around a ",(0,t.jsx)(n.strong,{children:"Pooled System Account"}),". This mechanism decouples the identity of the user from the public payment of fees, enabling fully anonymous on-chain fee settlements."]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Unlike off-chain relayer reimbursement (where a user pays a relayer privately and the relayer covers fees from their own account), the Relayer Flow enables users to pay network fees through the blockchain using their confidential POLYX balance, while maintaining full anonymity. All user fee contributions flow through a single system-wide pooled account, where individual contributions are indistinguishable."}),"\n",(0,t.jsx)(n.h2,{id:"the-pooled-fee-system",children:"The Pooled Fee System"}),"\n",(0,t.jsxs)(n.p,{children:["All relayer fee payments are managed through a single system-wide account. This pool acts as a ",(0,t.jsx)(n.strong,{children:"cryptographic mixing vault"})," where individual user contributions remain anonymous. Observers can see the total amount of POLYX entering and leaving the pool, but cannot identify which confidential account was credited with an encrypted balance or how those funds are later spent."]}),"\n",(0,t.jsx)(n.p,{children:"The on-chain address for the Pooled System Fee Account is:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mainnet SS58 address:"})," ",(0,t.jsx)(n.code,{children:"2EvQQsqdCSiF6Xm4Tr4TrWb4LovaozjtPsmt9QxRRZYp3mNq"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Testnet SS58 address:"})," ",(0,t.jsx)(n.code,{children:"5EYCAe5ijAx3nHtydpTBBYZojNDQTVdW46PpbvFTKDPSVRQy"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Hex public key:"})," ",(0,t.jsx)(n.code,{children:"0x6d6f646c706d2f64617274660000000000000000000000000000000000000000"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"fee-account-registration",children:"Fee Account Registration"}),"\n",(0,t.jsxs)(n.p,{children:["A user begins by registering a ",(0,t.jsx)(n.strong,{children:"confidential fee-paying account"})," specifically for the POLYX asset type. At registration, this account is initialized with a ",(0,t.jsx)(n.strong,{children:"balance of zero"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Because it is a confidential account:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Its identity is hidden within the global accumulator"}),"\n",(0,t.jsx)(n.li,{children:"Its state is represented as a cryptographic commitment"}),"\n",(0,t.jsx)(n.li,{children:"No public record links this account to the user's identity"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"top-up-funding-the-pool",children:"Top-up (Funding the Pool)"}),"\n",(0,t.jsxs)(n.p,{children:["Funding a fee account is a ",(0,t.jsx)(n.strong,{children:"protocol-driven, atomic operation"})," and must ",(0,t.jsx)(n.strong,{children:"not"})," be performed via a standard POLYX transfer to the pool account."]}),"\n",(0,t.jsx)(n.p,{children:"The process works as follows:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["The user generates an ",(0,t.jsx)(n.strong,{children:"account state transition"})," for their confidential POLYX account"]}),"\n",(0,t.jsxs)(n.li,{children:["This transition produces:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["A new ",(0,t.jsx)(n.strong,{children:"cryptographic commitment"})," representing the updated state"]}),"\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.strong,{children:"secret witness"})," that the user retains (used for future fee proofs)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Simultaneously, the protocol executes a ",(0,t.jsx)(n.strong,{children:"linked public transfer"})," of POLYX into the Pooled System Fee Account"]}),"\n",(0,t.jsxs)(n.li,{children:["While the transfer is visible on-chain, it is ",(0,t.jsx)(n.strong,{children:"cryptographically bound to the hidden commitment"})]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["A manual transfer to the system account without this state transition results in ",(0,t.jsx)(n.strong,{children:"irrecoverable funds"}),". The protocol requires the atomic coupling of the confidential state transition and the public transfer."]})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Privacy guarantee:"})," During top-up, the creditor's public key, confidential account public key and amount are ",(0,t.jsx)(n.strong,{children:"visible on-chain"}),". However, observers cannot identify how those funds are later spent in subsequent fee payments (where the confidential account public key becomes hidden and POLYX is transferred from the Pooled System Fee Account)"]}),"\n",(0,t.jsx)(n.h2,{id:"anonymous-fee-proof-generation",children:"Anonymous Fee Proof Generation"}),"\n",(0,t.jsxs)(n.p,{children:["When a user wants to execute a confidential asset transfer via a relayer service and needs to pay network fees, they generate a ",(0,t.jsx)(n.strong,{children:"Zero-Knowledge Fee Proof"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"This proof demonstrates:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The user possesses sufficient ",(0,t.jsx)(n.strong,{children:"hidden POLYX balance"})," within the Pooled System Account"]}),"\n",(0,t.jsxs)(n.li,{children:["The balance covers both the ",(0,t.jsx)(n.strong,{children:"network fee"})," and ",(0,t.jsx)(n.strong,{children:"relayer commission"})]}),"\n",(0,t.jsxs)(n.li,{children:["Without revealing:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Which specific top-up belongs to the user"}),"\n",(0,t.jsx)(n.li,{children:"Their total remaining fee balance"}),"\n",(0,t.jsx)(n.li,{children:"Any linkability to previous transactions"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"public-fee-values-vs-confidential-proof",children:"Public fee values vs. confidential proof"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Fee and commission are public values:"})," The network fee and relayer commission are not encrypted for the relayer. They are public inputs to the fee proof and are not part of the ZKP witness."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Sufficiency without revelation:"})," The fee proof shows the user's hidden fee balance is sufficient to cover those public amounts, without revealing the balance itself or which top-up it came from."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Accumulator membership:"})," The proof also shows the user's confidential fee account state is valid and unspent in the global accumulator."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"DoS protection for relayers:"})," Relayers verify the fee proof first, so they do not spend their own POLYX to broadcast a junk transaction."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"anonymous-submission--relayer-broadcast",children:"Anonymous Submission & Relayer Broadcast"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["The user sends their ZKP to a relayer via an ",(0,t.jsx)(n.strong,{children:"anonymous channel"})," (e.g., VPN or Tor)"]}),"\n",(0,t.jsxs)(n.li,{children:["The relayer ",(0,t.jsx)(n.strong,{children:"verifies the fee proof first"}),", checking for:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Valid cryptographic proof"}),"\n",(0,t.jsx)(n.li,{children:"Sufficient fee amount (DoS protection)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Upon validation, the relayer:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Signs"})," the transaction with their own key"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Broadcasts"})," it to the Polymesh network"]}),"\n",(0,t.jsx)(n.li,{children:"Uses their own POLYX to cover the initial execution cost"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"automatic-reimbursement-from-pool",children:"Automatic Reimbursement from Pool"}),"\n",(0,t.jsx)(n.p,{children:"Once the chain validates the ZKP:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["The protocol ",(0,t.jsx)(n.strong,{children:"deducts the fee and commission"})," from the user's hidden state in the Pooled System Account"]}),"\n",(0,t.jsx)(n.li,{children:"The user's confidential POLYX commitment is updated to reflect the reduced balance"}),"\n",(0,t.jsxs)(n.li,{children:["The relayer is ",(0,t.jsx)(n.strong,{children:"automatically reimbursed"})," the POLYX fee and commission from the pool"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"On-chain visibility:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The public sees POLYX movement from the Pooled System Account to the relayer"}),"\n",(0,t.jsxs)(n.li,{children:["The specific user connection remains ",(0,t.jsx)(n.strong,{children:"cryptographically obscured"})]}),"\n",(0,t.jsx)(n.li,{children:"No observer can determine which confidential account funded the fee"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"key-differences-from-off-chain-relayer-services",children:"Key Differences from Off-Chain Relayer Services"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Aspect"}),(0,t.jsx)(n.th,{children:"Off-Chain Relayer"}),(0,t.jsx)(n.th,{children:"Anonymous Fee Proofs"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"User pays relayer"})}),(0,t.jsx)(n.td,{children:"Via private channel (off-chain)"}),(0,t.jsx)(n.td,{children:"Via confidential on-chain proof"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Network fees paid by"})}),(0,t.jsx)(n.td,{children:"Relayer's public account"}),(0,t.jsx)(n.td,{children:"Pooled System Account"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Proof of payment"})}),(0,t.jsx)(n.td,{children:"Trust/contract outside chain"}),(0,t.jsx)(n.td,{children:"Cryptographic on-chain proof"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Privacy"})}),(0,t.jsx)(n.td,{children:"Relies on off-chain secrecy"}),(0,t.jsx)(n.td,{children:"Built into protocol mechanism"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Traceability"})}),(0,t.jsx)(n.td,{children:"Off-chain payment could leak identity"}),(0,t.jsx)(n.td,{children:"On-chain movement is mixed in pool"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Fee overhead"})}),(0,t.jsx)(n.td,{children:"Standard transaction fee"}),(0,t.jsx)(n.td,{children:"Additional on-chain processing for fee proof"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{title:"Fee Overhead",type:"note",children:(0,t.jsx)(n.p,{children:"Transactions submitted via a relayer that include an anonymous fee proof require a slightly higher network fee to cover the additional on-chain processing required to verify the fee payment proof and transfer POLYX from the pool in addition to the main confidential asset transaction."})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:"By using a pooled system account and Zero-Knowledge Proofs, the Relayer Flow ensures that:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Users can pay network fees anonymously through the blockchain"}),"\n",(0,t.jsx)(n.li,{children:"The total amount of POLYX flowing through the pool is visible (for transparency)"}),"\n",(0,t.jsxs)(n.li,{children:["The specific connection between a user and their fee payment is ",(0,t.jsx)(n.strong,{children:"cryptographically obscured"})]}),"\n",(0,t.jsxs)(n.li,{children:["It is effectively a ",(0,t.jsx)(n.strong,{children:"private tab maintained within a public vault"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This mechanism is essential for applications requiring full on-chain anonymity while still respecting the network's requirement that transaction fees be paid in POLYX."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453(e,n,i){i.d(n,{R:()=>r,x:()=>l});var s=i(96540);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);
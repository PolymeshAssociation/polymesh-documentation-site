"use strict";(self.webpackChunkpolymesh_developer_documentation=self.webpackChunkpolymesh_developer_documentation||[]).push([[88666],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),c=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return i.createElement(l.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),h=c(n),p=a,f=h["".concat(l,".").concat(p)]||h[p]||d[p]||r;return n?i.createElement(f,s(s({ref:t},u),{},{components:n})):i.createElement(f,s({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=p;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[h]="string"==typeof e?e:a,s[1]=o;for(var c=2;c<r;c++)s[c]=n[c];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},25064:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var i=n(87462),a=(n(67294),n(3905));const r={title:"Settlement",description:"",subsite:"polymesh-docs"},s=void 0,o={unversionedId:"primitives/settlement",id:"primitives/settlement",title:"Settlement",description:"",source:"@site/polymesh-docs/primitives/settlement.mdx",sourceDirName:"primitives",slug:"/primitives/settlement",permalink:"/polymesh-documentation-site/polymesh-docs/primitives/settlement",draft:!1,tags:[],version:"current",frontMatter:{title:"Settlement",description:"",subsite:"polymesh-docs"},sidebar:"defaultSidebar",previous:{title:"Portfolios and Custody",permalink:"/polymesh-documentation-site/polymesh-docs/primitives/portfolios-custody"}},l={},c=[{value:"Overview",id:"overview",level:2},{value:"Roles",id:"roles",level:2},{value:"Asset Issuer",id:"asset-issuer",level:3},{value:"Venue Creator",id:"venue-creator",level:3},{value:"Counterparty",id:"counterparty",level:3},{value:"Legs, Instructions and Venues",id:"legs-instructions-and-venues",level:2},{value:"Exempt Assets",id:"exempt-assets",level:2},{value:"Affirming and Custody",id:"affirming-and-custody",level:2},{value:"Examples",id:"examples",level:2},{value:"Peer to Peer Transfer",id:"peer-to-peer-transfer",level:3},{value:"Exchange Mediated Transfer",id:"exchange-mediated-transfer",level:3},{value:"Exchange Mediated Transfer with Authorisation",id:"exchange-mediated-transfer-with-authorisation",level:3},{value:"Netting Process",id:"netting-process",level:3},{value:"Security Token Offering",id:"security-token-offering",level:3}],u={toc:c};function h(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,i.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"Settlement in Polymesh is the process by which assets are transferred between identities in a regulated and compliant fashion."),(0,a.kt)("p",null,"It requires all counterparties of a transaction to affirm (agree) an instruction (a set of asset transfers) before the instruction settles (completes)."),(0,a.kt)("p",null,"Any counterparty to the instruction can unilaterally reject the instruction."),(0,a.kt)("p",null,"If an instruction is fully affirmed, but settlement fails (for example as a result of compliance rules) the instruction can be manually executed again at a later date by any one of the counterparties, once the failure cause has been remediated."),(0,a.kt)("p",null,"Once an instruction has been affirmed by a counterparty, the associated assets are locked in the counterparties account. If the instruction is subsequently rejected, these assets are unlocked and can be used in another settlement instruction."),(0,a.kt)("p",null,"Instructions can be settled either via:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"on-chain movement of assets")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"an off-chain payment receipt"))),(0,a.kt)("p",null,"Payment receipts are small pieces of data signed by an authorised signatory (determined by the venue on which the instruction is settling) which allege that the corresponding assets have moved off-chain. They can only be used for instruction legs that do not correspond to on-chain tickers."),(0,a.kt)("h2",{id:"roles"},"Roles"),(0,a.kt)("h3",{id:"asset-issuer"},"Asset Issuer"),(0,a.kt)("p",null,"The asset issuer (or agent on their behalf) controls the set of identities that are allowed to create instructions that reference their asset. They can also choose to leave this open."),(0,a.kt)("h3",{id:"venue-creator"},"Venue Creator"),(0,a.kt)("p",null,"Only the creator of a venue is allowed to create instructions underneath it."),(0,a.kt)("p",null,"The creator of a venue can cancel any pending instruction underneath it."),(0,a.kt)("p",null,"The venue creator controls the set of identities that are allowed to sign payment receipts for instructions underneath it."),(0,a.kt)("h3",{id:"counterparty"},"Counterparty"),(0,a.kt)("p",null,"A counterparty is relative to an instruction, and is any identity that is referenced as a payer / receiver in a leg within that instruction."),(0,a.kt)("p",null,"Each counterparty must authorise any instruction where they appear as a counterparty, before the instruction can settle."),(0,a.kt)("p",null,"Authorisation can be via an on-chain transaction, or signed data."),(0,a.kt)("p",null,"Once an instruction is authorised by a counterparty, their assets are locked, and the instruction will settle once all counterparties have authorised."),(0,a.kt)("p",null,"A counterparty can cancel a pending instruction. If any counterparty cancels, the entire instruction should be marked as cancelled (and everyone's assets unlocked)."),(0,a.kt)("h2",{id:"legs-instructions-and-venues"},"Legs, Instructions and Venues"),(0,a.kt)("p",null,"Instructions and Legs are always concrete - specify all details at the point of creation and are immutable."),(0,a.kt)("p",null,"For an instruction to be executed, all counterparties of the instruction must signal their authorisation and lock any necessary asset / provide appropriate receipts."),(0,a.kt)("p",null,"Only the creator of a venue can add instructions underneath it."),(0,a.kt)("p",null,"Authorisation can only be provided before the instructions expiry data, and after its valid_from date."),(0,a.kt)("p",null,"Asset issuers can restrict who can post an instruction that references their asset, or leave it unrestricted."),(0,a.kt)("p",null,"Once all counterparties have authorised an instruction, it is automatically executed. At that point, if the execution fails (e.g. due to compliance on the assets) then instruction is marked as failed, if it succeeds it is stamped with the time of the successful execution."),(0,a.kt)("p",null,"Any counterparty to an instruction can reject it, marking it as rejected immediately, or simply wait until it expires."),(0,a.kt)("p",null,"A counterparty's authorisation is only valid if they either lock the relevant amount of assets to the instruction to cover any of their obligations across all legs, or provide a signed receipt that the transaction has occurred off-chain."),(0,a.kt)("p",null,"Payment receipts which are used to authorise an instruction are specific to a given instruction, and cannot be used for other instructions."),(0,a.kt)("p",null,"If an instruction fails, is rejected or expires, all asset locks are removed."),(0,a.kt)("p",null,"If an instruction is executed, assets are transferred between counterparties for on-chain assets (i.e. excluding legs which are settled via a payment receipt that can only reference off-chain assets)."),(0,a.kt)("h2",{id:"exempt-assets"},"Exempt Assets"),(0,a.kt)("p",null,"For certain types of assets, e.g. stable coins, it may not be appropriate to require all users to explicitly affirm transactions where they receive the asset (either directly or via their custodian)."),(0,a.kt)("p",null,'In this case Polymesh allows users to "pre-approve" certain tickers meaning that explicit affirmations are no longer required. Certain tickers can also be excluded from requiring affirmation on receipt globally via the Polymesh governing council.'),(0,a.kt)("h2",{id:"affirming-and-custody"},"Affirming and Custody"),(0,a.kt)("p",null,"If a custodian has been granted access to a users portfolio, the custodian is able to affirm any instructions that reference that portfolio on behalf of their client."),(0,a.kt)("p",null,"This allows control to be handed to a custodian, whilst the record of beneficial ownership remains with the owner of the assets."),(0,a.kt)("h2",{id:"examples"},"Examples"),(0,a.kt)("h3",{id:"peer-to-peer-transfer"},"Peer to Peer Transfer"),(0,a.kt)("p",null,"Alice wants to transfer 10 ACME tokens to Bob as a gift."),(0,a.kt)("p",null,"She uses her \u201cdefault\u201d venue (or any venue that she has previously created) to generate an instruction, with a single leg."),(0,a.kt)("p",null,"If Bob has provided pre-authorisation via signed data to Alice, she can submit it alongside the transaction as Bobs authorisation, and her own authorisation is implicit (since she is creating the instruction). Alice's ACME tokens are locked until Bob authorises the instruction (or Alice cancels), assuming he has not pre-authorised."),(0,a.kt)("p",null,"Once the instruction has been fully authorised (which can happen upon creation if pre-authorised) it settles with Bob receiving 10 ACME tokens."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Peer to peer",src:n(43526).Z,width:"2363",height:"604"})),(0,a.kt)("h3",{id:"exchange-mediated-transfer"},"Exchange Mediated Transfer"),(0,a.kt)("p",null,"ExchangeCo matches Alice, a seller of ACME, with Bob, a buyer of ACME, and coordinates an agreed price to exchange assets - 100 ACME for 10 USDC."),(0,a.kt)("p",null,"ExchangeCo creates a venue, adds a single instruction, with two legs, and an expiry time of T + 1 hour."),(0,a.kt)("p",null,"Bob authorises the instruction, locking 10 USDC."),(0,a.kt)("p",null,"Alice authorises the instruction, locking 100 ACME."),(0,a.kt)("p",null,"The instruction is executed with Alice receiving 10 USDC and Bob receiving 100 ACME."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Asset vs. Asset",src:n(62781).Z,width:"2325",height:"969"})),(0,a.kt)("h3",{id:"exchange-mediated-transfer-with-authorisation"},"Exchange Mediated Transfer with Authorisation"),(0,a.kt)("p",null,"ExchangeCo matches Alice, a seller of ACME, with Bob, a buyer of ACME, and coordinates an agreed price to exchange assets - 100 ACME for 10 USDC."),(0,a.kt)("p",null,"ExchangeCo collects a signed authorisation from Alice and Bob indicating that they agree a specific instruction."),(0,a.kt)("p",null,"Bob's authorisation includes a signed receipt that he has transferred funds to Alice, meaning that no additional funds are locked from Bob into the instruction, and instead his receipt signed data is marked as locked."),(0,a.kt)("p",null,"ExchangeCo creates a venue, with a single instruction with two legs, providing the authorisation data from Alice and Bob."),(0,a.kt)("p",null,"The instruction is authorised upon creation, and immediately settles, transferring 100 ACME from Alice to Bob and marking Bob's receipt as used."),(0,a.kt)("h3",{id:"netting-process"},"Netting Process"),(0,a.kt)("p",null,"ClearCo, with a pre-agreed netting contract with BankCo's, collects trade data from BankCo_1, BankCo_2, BankCo_3 and BankCo_4 and calculates an optimal netting strategy."),(0,a.kt)("p",null,"ClearCo creates a venue with an instruction containing four legs representing the netting trades between BankCo's and an expiry time of T + 24 hours."),(0,a.kt)("p",null,"Each BankCo individually authorises the instruction - when all BankCo's have authorised the netting settlement is automatically executed."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Netting",src:n(83920).Z,width:"2363",height:"1879"})),(0,a.kt)("h3",{id:"security-token-offering"},"Security Token Offering"),(0,a.kt)("p",null,"AcmeCo wishes to distribute 1000 ACME tokens to investors."),(0,a.kt)("p",null,"AcmeCo creates a Venue defining the start and end date of their issuance."),(0,a.kt)("p",null,"Alice provides AcmeCo with an authorisation to buy 100 ACME tokens at 10 USDC (i.e. an authorisation for an instruction with these two legs)."),(0,a.kt)("p",null,"AcmeCo creates an instruction under their settlement passing along Alice's authorisation, along with their own. The instruction is executed with Alice receiving her ACME tokens, and AcmeCo receiving their assets."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Primary Distribution / Funding",src:n(46574).Z,width:"2475",height:"3150"})))}h.isMDXComponent=!0},83920:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Netting-3e5e9ecfdf1238e3783182f0473ad89c.png"},43526:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/P2P-3e1d1234206919a73682128120919f85.png"},46574:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/STO-671f74b9c5575038554c5b3e2f6e5cfe.png"},62781:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/TvT-ac9d7ab52e582490c121f7587d65313d.png"}}]);